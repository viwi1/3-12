<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3:12 Utdelningskalkylator</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
    .slider-container { display: flex; align-items: center; margin-bottom: 10px; }
    .slider-value { width: 60px; margin-left: 10px; font-weight: bold; }
    .box { border: 1px solid #ccc; padding: 15px; margin-top: 10px; background: #f9f9f9; }
    .result-title { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
    .checkbox-container { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
  </style>
</head>
<body>

  <h2>3:12 Utdelningskalkylator</h2>

  <h3>1Ô∏è‚É£ Kapital efter f√∂rs√§ljning och utdelning per √•r</h3>
  
  <p><strong>Nuvarande v√§rde p√• bolaget:</strong> <span id="nuvarde"></span></p>

  <div class="checkbox-container">
    <input type="checkbox" id="daligtNuvarde" onchange="uppdateraNuvarde()">
    <label for="daligtNuvarde">D√•ligt v√§rde (3 000 000 kr)</label>
  </div>

  <div class="checkbox-container">
    <input type="checkbox" id="betalaHuslan" onchange="uppdateraBer√§kningar()">
    <label for="betalaHuslan">üè° Betala av husl√•net direkt vid exit (med 3:12-optimering)</label>
  </div>

  <div class="slider-container">
    <label for="multipel">Multipel:</label>
    <input type="range" id="multipel" min="1.1" max="4" step="0.1" value="1.5" oninput="uppdateraBer√§kningar()">
    <span class="slider-value" id="multipelValue">1.5</span>
  </div>

  <!-- Slider f√∂r avkastning -->
  <div class="slider-container">
    <label for="avkastning">Avkastning (% per √•r):</label>
    <input type="range" id="avkastning" min="1" max="30" step="1" value="10" oninput="uppdateraBer√§kningar()">
    <span class="slider-value" id="avkastningValue">10%</span>
  </div>

  <label for="huslan">Nuvarande husl√•n (kr):</label>
  <input type="number" id="huslan" value="2000000" oninput="uppdateraBer√§kningar()">

  <label for="ibb">Inkomstbasbelopp (IBB) f√∂r √•ret:</label>
  <input type="number" id="ibb" value="80600" oninput="uppdateraBer√§kningar()">
  <p><a href="https://www.pensionsmyndigheten.se/forsta-din-pension/om-pensionssystemet/sa-beraknas-din-pension-basbelopp-berakningsfaktorer-och-varderegler" target="_blank">Kolla upp √•rets IBB h√§r</a></p>

  <p><strong>Gr√§nsv√§rde (IBB √ó 2,75):</strong> <span id="gransvarde"></span></p>

  <div class="result" id="resultF√∂rs√§ljning"></div>
  <div class="result" id="resultAktieutdelning"></div>

  <script>
    let normaltNuvarde = 6855837;
    let daligtNuvarde = 3000000;
    let nuvarde = normaltNuvarde;

    function formatNumber(num) {
      return num.toLocaleString("sv-SE") + " kr";
    }

    function uppdateraNuvarde() {
      let checkbox = document.getElementById("daligtNuvarde");
      nuvarde = checkbox.checked ? daligtNuvarde : normaltNuvarde;
      document.getElementById("nuvarde").textContent = formatNumber(nuvarde);
      uppdateraBer√§kningar();
    }

    function ber√§knaUtdelning(totalAvkastning, gransvarde, skattL√•g, skattH√∂g) {
      let bruttoL√•g = Math.min(totalAvkastning, gransvarde);
      let bruttoH√∂g = totalAvkastning > gransvarde ? totalAvkastning - gransvarde : 0;
      let nettoL√•g = bruttoL√•g * (1 - skattL√•g);
      let nettoH√∂g = bruttoH√∂g * (1 - skattH√∂g);
      let totalNetto = nettoL√•g + nettoH√∂g;
      return { bruttoL√•g, bruttoH√∂g, nettoL√•g, nettoH√∂g, totalNetto };
    }

    function uppdateraBer√§kningar() {
      let multipel = parseFloat(document.getElementById("multipel").value);
      let avkastning = parseFloat(document.getElementById("avkastning").value) / 100;
      let huslan = parseFloat(document.getElementById("huslan").value);
      let ibb = parseFloat(document.getElementById("ibb").value);
      let betalaHuslan = document.getElementById("betalaHuslan").checked;

      document.getElementById("multipelValue").textContent = multipel.toFixed(1);
      document.getElementById("avkastningValue").textContent = (avkastning * 100).toFixed(0) + "%";

      let gransvarde = ibb * 2.75;
      document.getElementById("gransvarde").textContent = formatNumber(gransvarde);

      let f√∂rs√§ljningspris = nuvarde * multipel;
      let exitKapital = f√∂rs√§ljningspris;
      let skattL√•g = 0.20;
      let skattH√∂g = 0.50;

      let nettoL√•g = gransvarde * (1 - skattL√•g); 
      let l√•nebehovEfterL√•gSkatt = huslan - nettoL√•g;
      let bruttoH√∂gBehov = l√•nebehovEfterL√•gSkatt / (1 - skattH√∂g);
      let totaltBruttoF√∂rL√•n = gransvarde + bruttoH√∂gBehov;
      let nettoTotalt = nettoL√•g + l√•nebehovEfterL√•gSkatt;

      if (betalaHuslan) {
        exitKapital -= totaltBruttoF√∂rL√•n;
      }

      document.getElementById("resultF√∂rs√§ljning").innerHTML = `
        <div class="box">
          <p class="result-title">${betalaHuslan ? "Exitbelopp efter husl√•nsbetalning üè°" : "Exitbelopp"}</p>
          <p><strong>${formatNumber(exitKapital)}</strong></p>
          ${betalaHuslan ? `
            <p><strong>Utr√§kning av husl√•nsbetalning:</strong></p>
            <p>Bruttobelopp som kr√§vs: ${formatNumber(totaltBruttoF√∂rL√•n)}</p>
            <p>- Gr√§nsv√§rde 3:12 (20% skatt): ${formatNumber(gransvarde)} ‚Üí Netto: ${formatNumber(nettoL√•g)}</p>
            <p>- Resterande belopp (50% skatt): ${formatNumber(bruttoH√∂gBehov)} ‚Üí Netto: ${formatNumber(l√•nebehovEfterL√•gSkatt)}</p>
            <p><strong>Totalt netto anv√§nt f√∂r l√•n:</strong> ${formatNumber(nettoTotalt)}</p>
          ` : ""}
        </div>
      `;

      let totalAvkastningJust = exitKapital * avkastning;
      let totalAvkastningOjust = f√∂rs√§ljningspris * avkastning;

      let utdelningJust = ber√§knaUtdelning(totalAvkastningJust, gransvarde, skattL√•g, skattH√∂g);
      let utdelningOjust = ber√§knaUtdelning(totalAvkastningOjust, gransvarde, skattL√•g, skattH√∂g);
      let skillnad = utdelningOjust.totalNetto - utdelningJust.totalNetto;

      document.getElementById("resultAktieutdelning").innerHTML = `
        <div class="box">
          <p class="result-title">Aktieutdelning</p>
          <p>Brutto: ${formatNumber(totalAvkastningJust)}</p>
          <p>Inom gr√§nsv√§rde (20% skatt): ${formatNumber(Math.min(totalAvkastningJust, gransvarde))} ‚Üí Netto: ${formatNumber(Math.min(totalAvkastningJust, gransvarde) * (1 - skattL√•g))}</p>
          <p>√ñver gr√§nsv√§rde (50% skatt): ${formatNumber(totalAvkastningJust > gransvarde ? totalAvkastningJust - gransvarde : 0)} ‚Üí Netto: ${formatNumber(totalAvkastningJust > gransvarde ? (totalAvkastningJust - gransvarde) * (1 - skattH√∂g) : 0)}</p>
          <p><strong>Totalt netto utdelning:</strong> ${formatNumber(utdelningJust.totalNetto)}</p>
          ${betalaHuslan ? `
            <p><strong>Utan att betala husl√•n:</strong> ${formatNumber(utdelningOjust.totalNetto)}</p>
            <p><strong>Skillnad:</strong> ${formatNumber(skillnad)}</p>
          ` : ""}
        </div>
      `;
    }

    window.onload = function() {
      uppdateraNuvarde();
    };
  </script>

</body>
</html>
