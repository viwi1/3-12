<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>3:12 Utdelningskalkylator</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
    .slider-container { display: flex; align-items: center; margin-bottom: 10px; }
    .slider-value { width: 60px; margin-left: 10px; font-weight: bold; }
    .box { border: 1px solid #ccc; padding: 15px; margin-top: 10px; background: #f9f9f9; }
    .result-title { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
    .checkbox-container { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
    label { display: block; margin-top: 10px; }
  </style>
</head>
<body>

  <h3>Kapital efter f√∂rs√§ljning och utdelning per √•r</h3>

  <!-- 1) V√§rde p√• bolaget -->
  <p><strong>Nuvarande v√§rde p√• bolaget:</strong> <span id="nuvarde"></span></p>
  <div class="checkbox-container">
    <input type="checkbox" id="daligtNuvarde" onchange="uppdateraNuvarde()" />
    <label for="daligtNuvarde">3 000 000 kr</label>
  </div>

  <!-- 2) Multipel -->
  <div class="slider-container">
    <label for="multipel">Multipel:</label>
    <!-- OBS! step=0.1 om du vill kunna v√§lja decimaler internt -->
    <input type="range" id="multipel" min="1.1" max="4" step="0.1" value="1.5" oninput="uppdateraBer√§kningar()" />
    <span class="slider-value" id="multipelValue">1</span>
  </div>

  <!-- 3) Val av att betala husl√•n -->
  <div class="checkbox-container">
    <input type="checkbox" id="betalaHuslan" onchange="uppdateraBer√§kningar()" />
    <label for="betalaHuslan">üè° Betala av husl√•net direkt vid exit</label>
  </div>

  <!-- 4) Husl√•n + IBB -->
  <label for="huslan">Nuvarande husl√•n (kr):</label>
  <input type="number" id="huslan" value="2000000" oninput="uppdateraBer√§kningar()"/>

  <label for="ibb">Inkomstbasbelopp (IBB) f√∂r √•ret:</label>
  <input type="number" id="ibb" value="80600" oninput="uppdateraBer√§kningar()"/>
  <p>
    <a
      href="https://www.pensionsmyndigheten.se/forsta-din-pension/om-pensionssystemet/sa-beraknas-din-pension-basbelopp-berakningsfaktorer-och-varderegler"
      target="_blank"
      >Kolla upp √•rets IBB h√§r</a
    >
  </p>

  <!-- 5) Visning av gr√§nsv√§rde, f√∂rs√§ljningsresultat och aktieutdelning -->
  <p><strong>Gr√§nsv√§rde (IBB √ó 2,75):</strong> <span id="gransvarde"></span></p>
  <div class="result" id="resultF√∂rs√§ljning"></div>

  <!-- H√§r l√§gger vi fast HTML-strukturen f√∂r aktieutdelnings-rutan, inkl slider -->
  <div class="result" id="resultAktieutdelning">
    <div class="box">
      <p class="result-title">Aktieutdelning</p>

      <!-- Flyttad slider f√∂r avkastning ‚Äì men h√•rdkodad i HTML: -->
      <div class="slider-container">
        <label for="avkastning">Avkastning (% per √•r):</label>
        <input
          type="range"
          id="avkastning"
          min="1"
          max="30"
          step="1"
          value="10"
          oninput="uppdateraBer√§kningar()"
        />
        <span class="slider-value" id="avkastningValue">10%</span>
      </div>

      <p>Brutto: <span id="brutto"></span></p>
      <p>
        Inom gr√§nsv√§rde (20% skatt):
        <span id="inomGransvardeBrutto"></span>
        ‚Üí Netto: <span id="inomGransvardeNetto"></span>
      </p>
      <p>
        √ñver gr√§nsv√§rde (50% skatt):
        <span id="overGransvardeBrutto"></span>
        ‚Üí Netto: <span id="overGransvardeNetto"></span>
      </p>
      <p>
        <strong>Totalt netto utdelning:</strong>
        <span id="totaltNetto"></span>
      </p>
      <!-- Endast synlig om ‚ÄùBetala husl√•n‚Äù √§r ikryssad -->
      <div id="utdelningHuslan" style="display:none;">
        <p>
          <strong>Utan att betala husl√•n:</strong>
          <span id="utdelningOjust"></span>
        </p>
        <p>
          <strong>Skillnad:</strong>
          <span id="utdelningSkillnad"></span>
        </p>
      </div>
    </div>
  </div>

  <script>
    // Ursprungsdata
    let normaltNuvarde = 6855837;
    let daligtNuvarde = 3000000;
    let nuvarde = normaltNuvarde;

    // Format med avrundning till heltal, svenska tusentalsavgr√§nsare
    function formatNumber(num) {
      return Math.round(num).toLocaleString("sv-SE") + " kr";
    }

    // Sl√•r ihop den traditionella ber√§kningen av utdelning
    function ber√§knaUtdelning(totalAvkastning, gransvarde, skattL√•g, skattH√∂g) {
      let bruttoL√•g = Math.min(totalAvkastning, gransvarde);
      let bruttoH√∂g = totalAvkastning > gransvarde ? totalAvkastning - gransvarde : 0;
      let nettoL√•g = bruttoL√•g * (1 - skattL√•g);
      let nettoH√∂g = bruttoH√∂g * (1 - skattH√∂g);
      let totalNetto = nettoL√•g + nettoH√∂g;
      return { bruttoL√•g, bruttoH√∂g, nettoL√•g, nettoH√∂g, totalNetto };
    }

    // V√§xlar mellan normalt v√§rde och d√•ligt v√§rde
    function uppdateraNuvarde() {
      let checkbox = document.getElementById("daligtNuvarde");
      nuvarde = checkbox.checked ? daligtNuvarde : normaltNuvarde;
      document.getElementById("nuvarde").textContent = formatNumber(nuvarde);
      uppdateraBer√§kningar();
    }

    function uppdateraBer√§kningar() {
      // H√§mta multipel (med decimals i koden) men vi visar som heltal
      let multipel = parseFloat(document.getElementById("multipel").value);

      // H√§mta avkastningsprocent (heltal), men ber√§kna decimalt
      let avkastningRange = document.getElementById("avkastning");
      let avkastningProcent = parseInt(avkastningRange.value, 10); 
      let avkastning = avkastningProcent / 100;

      // H√§mta husl√•n, IBB och om man vill betala husl√•n
      let huslan = parseFloat(document.getElementById("huslan").value);
      let ibb = parseFloat(document.getElementById("ibb").value);
      let betalaHuslan = document.getElementById("betalaHuslan").checked;

      // Visa multipeln som heltal (avrundat)
      document.getElementById("multipelValue").textContent = Math.round(multipel).toString();
      // Visa avkastningsprocent utan decimaler
      document.getElementById("avkastningValue").textContent = avkastningProcent + "%";

      // R√§kna fram gr√§nsv√§rde
      let gransvarde = ibb * 2.75;
      document.getElementById("gransvarde").textContent = formatNumber(gransvarde);

      // F√∂rs√§ljningspris (ev. decimal i multipel men rundas ej i sj√§lva multiplikationen)
      let f√∂rs√§ljningspris = nuvarde * multipel;
      let exitKapital = f√∂rs√§ljningspris;

      // Skattesatser
      let skattL√•g = 0.20;
      let skattH√∂g = 0.50;

      // Utr√§kning f√∂r att betala av husl√•net
      let nettoL√•g = gransvarde * (1 - skattL√•g); 
      let l√•nebehovEfterL√•gSkatt = huslan - nettoL√•g;
      let bruttoH√∂gBehov = l√•nebehovEfterL√•gSkatt / (1 - skattH√∂g);
      let totaltBruttoF√∂rL√•n = gransvarde + bruttoH√∂gBehov;
      let nettoTotalt = nettoL√•g + l√•nebehovEfterL√•gSkatt;

      // Om man valt att betala husl√•net direkt
      if (betalaHuslan) {
        exitKapital -= totaltBruttoF√∂rL√•n;
      }

      // Skriv ut resultat f√∂r f√∂rs√§ljning
      let htmlF√∂rs√§ljning = `
        <div class="box">
          <p class="result-title">${betalaHuslan ? "Exitbelopp efter husl√•nsbetalning üè°" : "Exitbelopp"}</p>
          <p><strong>${formatNumber(exitKapital)}</strong></p>
      `;
      if (betalaHuslan) {
        htmlF√∂rs√§ljning += `
          <p><strong>Utr√§kning av husl√•nsbetalning:</strong></p>
          <p>Bruttobelopp som kr√§vs: ${formatNumber(totaltBruttoF√∂rL√•n)}</p>
          <p>- Gr√§nsv√§rde 3:12 (20% skatt): ${formatNumber(gransvarde)} ‚Üí Netto: ${formatNumber(nettoL√•g)}</p>
          <p>- Resterande belopp (50% skatt): ${formatNumber(bruttoH√∂gBehov)} ‚Üí Netto: ${formatNumber(l√•nebehovEfterL√•gSkatt)}</p>
          <p><strong>Totalt netto anv√§nt f√∂r l√•n:</strong> ${formatNumber(nettoTotalt)}</p>
        `;
      }
      htmlF√∂rs√§ljning += `</div>`;
      document.getElementById("resultF√∂rs√§ljning").innerHTML = htmlF√∂rs√§ljning;

      // Ber√§kna utdelning beroende p√• exitKapital
      let totalAvkastningJust = exitKapital * avkastning;   // Om husl√•net betalats
      let totalAvkastningOjust = f√∂rs√§ljningspris * avkastning; // Om husl√•net ej betalats alls

      let utdelningJust = ber√§knaUtdelning(totalAvkastningJust, gransvarde, skattL√•g, skattH√∂g);
      let utdelningOjust = ber√§knaUtdelning(totalAvkastningOjust, gransvarde, skattL√•g, skattH√∂g);
      let skillnad = utdelningOjust.totalNetto - utdelningJust.totalNetto;

      // Fyll i v√§rden i aktieutdelnings-rutan
      document.getElementById("brutto").textContent = formatNumber(totalAvkastningJust);
      document.getElementById("inomGransvardeBrutto").textContent = formatNumber(utdelningJust.bruttoL√•g);
      document.getElementById("inomGransvardeNetto").textContent = formatNumber(utdelningJust.nettoL√•g);
      document.getElementById("overGransvardeBrutto").textContent = formatNumber(utdelningJust.bruttoH√∂g);
      document.getElementById("overGransvardeNetto").textContent = formatNumber(utdelningJust.nettoH√∂g);
      document.getElementById("totaltNetto").textContent = formatNumber(utdelningJust.totalNetto);

      // Om man har bockat i att betala husl√•n visar vi √§ven ‚Äùutan att betala husl√•n‚Äù
      let utdHuslanDiv = document.getElementById("utdelningHuslan");
      if (betalaHuslan) {
        utdHuslanDiv.style.display = "block";
        document.getElementById("utdelningOjust").textContent = formatNumber(utdelningOjust.totalNetto);
        document.getElementById("utdelningSkillnad").textContent = formatNumber(skillnad);
      } else {
        utdHuslanDiv.style.display = "none";
      }
    }

    // Init
    window.onload = function() {
      uppdateraNuvarde();
    };
  </script>
</body>
</html>
