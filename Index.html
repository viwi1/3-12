<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3:12 Utdelningskalkylator</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
        .slider-container { display: flex; align-items: center; margin-bottom: 10px; }
        .slider-value { width: 60px; margin-left: 10px; font-weight: bold; }
        .box { border: 1px solid #ccc; padding: 15px; margin-top: 10px; background: #f9f9f9; }
        .result-title { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
        .result-value { font-size: 16px; font-weight: bold; color: #007bff; }
        .checkbox-container { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <h2>3:12 Utdelningskalkylator</h2>

    <h3>1Ô∏è‚É£ Kapital efter f√∂rs√§ljning och utdelning per √•r</h3>
    
    <p><strong>Nuvarande v√§rde p√• bolaget:</strong> <span id="nuvarde"></span></p>

    <div class="checkbox-container">
        <input type="checkbox" id="daligtNuvarde" onchange="uppdateraNuvarde()">
        <label for="daligtNuvarde">D√•ligt v√§rde (3 000 000 kr)</label>
    </div>

    <div class="checkbox-container">
        <input type="checkbox" id="betalaHuslan" onchange="uppdateraBer√§kningar()">
        <label for="betalaHuslan">üè° Betala av husl√•net direkt vid exit</label>
    </div>

    <div class="slider-container">
        <label for="multipel">Multipel:</label>
        <input type="range" id="multipel" min="1.1" max="4" step="0.1" value="1.5" oninput="uppdateraBer√§kningar()">
        <span class="slider-value" id="multipelValue">1.5</span>
    </div>

    <div class="slider-container">
        <label for="avkastning">Avkastning (% per √•r):</label>
        <input type="range" id="avkastning" min="1" max="30" step="1" value="10" oninput="uppdateraBer√§kningar()">
        <span class="slider-value" id="avkastningValue">10%</span>
    </div>

    <label for="huslan">Nuvarande husl√•n (kr):</label>
    <input type="number" id="huslan" value="2000000" oninput="uppdateraBer√§kningar()">

    <div class="result" id="resultF√∂rs√§ljning"></div>
    <div class="result" id="resultAktieutdelning"></div>

    <script>
        let normaltNuvarde = 6855837;
        let daligtNuvarde = 3000000;
        let nuvarde = normaltNuvarde;

        function formatNumber(num) {
            return num.toLocaleString("sv-SE") + " kr";
        }

        function uppdateraNuvarde() {
            let checkbox = document.getElementById("daligtNuvarde");
            nuvarde = checkbox.checked ? daligtNuvarde : normaltNuvarde;
            document.getElementById("nuvarde").textContent = formatNumber(nuvarde);
            uppdateraBer√§kningar();
        }

        function uppdateraBer√§kningar() {
            let multipel = parseFloat(document.getElementById("multipel").value);
            let avkastning = parseFloat(document.getElementById("avkastning").value) / 100;
            let huslan = parseFloat(document.getElementById("huslan").value);
            let betalaHuslan = document.getElementById("betalaHuslan").checked;

            document.getElementById("multipelValue").textContent = multipel.toFixed(1);
            document.getElementById("avkastningValue").textContent = (avkastning * 100).toFixed(0) + "%";

            let f√∂rs√§ljningspris = nuvarde * multipel;
            let exitKapital = betalaHuslan ? f√∂rs√§ljningspris - (huslan / 0.5) : f√∂rs√§ljningspris;

            let totalAvkastningJust = exitKapital * avkastning;
            let totalAvkastningOjust = f√∂rs√§ljningspris * avkastning;

            let gr√§nsbelopp = 209550;
            let skattL√•g = 0.20;
            let skattH√∂g = 0.50;

            function ber√§knaUtdelning(totalAvkastning) {
                let bruttoL√•g = Math.min(totalAvkastning, gr√§nsbelopp);
                let bruttoH√∂g = totalAvkastning > gr√§nsbelopp ? totalAvkastning - gr√§nsbelopp : 0;
                let nettoL√•g = bruttoL√•g * (1 - skattL√•g);
                let nettoH√∂g = bruttoH√∂g * (1 - skattH√∂g);
                let totalNetto = nettoL√•g + nettoH√∂g;
                return { bruttoL√•g, bruttoH√∂g, nettoL√•g, nettoH√∂g, totalNetto };
            }

            let utdelningJust = ber√§knaUtdelning(totalAvkastningJust);
            let utdelningOjust = ber√§knaUtdelning(totalAvkastningOjust);
            let skillnad = utdelningOjust.totalNetto - utdelningJust.totalNetto;

            document.getElementById("resultF√∂rs√§ljning").innerHTML = `
                <div class="box">
                    <p class="result-title">${betalaHuslan ? "Exitbelopp n√§r husl√•n √§r betalat üè°" : "Exitbelopp"}</p>
                    <p><strong>${formatNumber(exitKapital)}</strong></p>
                </div>
            `;

            let aktieutdelningHtml = `
                <div class="box">
                    <p class="result-title">Aktieutdelning</p>
                    <p>Brutto: ${formatNumber(totalAvkastningJust)}</p>
                    <p>Inom gr√§nsbelopp (20% skatt): ${formatNumber(utdelningJust.bruttoL√•g)} ‚Üí Netto: ${formatNumber(utdelningJust.nettoL√•g)}</p>
                    <p>√ñver gr√§nsbelopp (50% skatt): ${formatNumber(utdelningJust.bruttoH√∂g)} ‚Üí Netto: ${formatNumber(utdelningJust.nettoH√∂g)}</p>
                    <p><strong>Totalt netto utdelning:</strong> ${formatNumber(utdelningJust.totalNetto)}</p>
            `;

            if (betalaHuslan) {
                aktieutdelningHtml += `
                    <p><strong>Utan att betala husl√•n:</strong></p>
                    <p>Totalt netto utdelning: ${formatNumber(utdelningOjust.totalNetto)}</p>
                `;
                if (skillnad > 0) {
                    aktieutdelningHtml += `<p><strong>Skillnad:</strong> ${formatNumber(skillnad)}</p>`;
                }
            }

            aktieutdelningHtml += `</div>`;
            document.getElementById("resultAktieutdelning").innerHTML = aktieutdelningHtml;
        }

        window.onload = function() {
            uppdateraNuvarde();
        };
    </script>

</body>
</html>
